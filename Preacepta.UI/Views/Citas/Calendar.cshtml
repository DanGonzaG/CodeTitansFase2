@using Praecepta.UI.Models
@model IEnumerable<Preacepta.Modelos.AbstraccionesFrond.CitasDTO>



<head>
    <link href="~/calendario/stylecalendar.css" rel="stylesheet" />
    <link href="~/calendario/calendardaniel.css" rel="stylesheet" />
    <title>Calendar with Events</title>
</head>





<!-- Page Title -->
<div class="page-title-area page-title-area-two title-img-one">
    <div class="d-table">
        <div class="d-table-cell">
            <div class="page-title-text">
                <h2>Calendario y eventos</h2>
                <ul>
                    <li>
                        <a asp-controller="Home" asp-action="Index">Home</a>
                    </li>
                    <li>
                        <i class="icofont-simple-right"></i>
                    </li>
                    <li>Calendario</li>
                </ul>
            </div>
        </div>
    </div>
</div>
<!-- End Page Title -->




<div style="margin-bottom:10px; margin-top:10px" class="containerCalendar">
    <div class="left">
        <div class="calendar">
            <div class="month">
                <i class="fas fa-angle-left prev"></i>
                <div class="date">december 2015</div>
                <i class="fas fa-angle-right next"></i>
            </div>
            <div class="weekdays">
                <div>Domingo</div>
                <div>Lunes</div>
                <div>Martes</div>
                <div>Miércoles</div>
                <div>Jueves</div>
                <div>Viernes</div>
                <div>Sabado</div>
            </div>
            <div class="days"></div>
            <div class="goto-today">
                <div class="goto">
                    <input type="text" placeholder="mm/aaaa" class="date-input" />
                    <button class="goto-btn">Ir</button>
                </div>
                <button class="today-btn">Hoy</button>
            </div>
        </div>
    </div>
    <div class="right">
        <div class="today-date">
            <div class="event-day">Mie</div>
            <div class="event-date">12th december 2022</div>
        </div>
        <form asp-controller="Citas" asp-action="Create" method="post">
             @Html.AntiForgeryToken()
        <div class="events"></div>
            <!--<div class="add-event-wrapper">-->
            <div class="add-event-header">
                <div class="title">Añadir cita</div>
                <i class="fas fa-times close"></i>
            </div>
            <div class="add-event-body">
                <div class="add-event-input">
                    <input name="Hora" type="time" placeholder="Hora" class="event-time-from" />
                </div>
                <div class="add-event-input">
                    <input name="Fecha" type="date" placeholder="Fecha" class="event-date" />
                </div>

                <div class="add-event-input">
                    <input type="url" name="LinkVideo" placeholder="Link de videoconferencia" />
                </div>
                <div class="add-event-input">
                    <input type="text" name="Anfitrion" placeholder="Anfitrión" />
                </div>
                </div>
            <div class="add-event-footer">
                <input type="submit" value="Crear" class="btn btn-primary" />
                <a asp-action="Calendar" class="btn btn-secondary">Cancelar</a>
            </div>
            <!--</--div>-->
        </form>
    </div>
    <button class="add-event" id="btnAddCita" title="Añadir cita">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Botón de ver lista -->
    <a href="/Citas/Citas" class="add-event" title="Ver lista de citas" style="right: 70px;">
        <i class="fas fa-list"></i>
    </a>
   
</div>
<div class="formulario contact-form contact-form-two contact-form-three">
    <div class="container">
        <div class="contact-wrap" style="display: flex; justify-content: center; align-items: center;">
            <button style="margin-right: 5px" type="button" id="PrevioBtn" class="contact-btn" data-bs-toggle="modal" data-bs-target="#ModalCitasPasadas">
                Citas Pasadas
            </button>
            <button style="margin-left: 5px" type="button" id="PrevioBtn" class="contact-btn" data-bs-toggle="modal" data-bs-target="#ModalCitasFuturas">
                Citas Futuras
            </button>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="ModalCitasFuturas" tabindex="-1" aria-labelledby="exampleModalLabel" inert">
    <div class="modal-dialog modal-lg DanielModalCitasFuturas">
        <div class="modal-content" style="color:black">
            <div class="formulario contact-form contact-form-two">
                <div class="container">
                    <div class="contact-wrap">
                        <h2>Revisión de datos ingresados</h2>
                        <table id="tablaCitasFuturas" class="table">
                            <thead>
                                <tr>
                                    <th>ID Cita</th>
                                    <th>Fecha y Hora</th>
                                    <th>Tipo de Cita</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    var fechaCompleta = new DateTime(item.Fecha.Year, item.Fecha.Month, item.Fecha.Day, item.Hora.Hour, item.Hora.Minute, 0);
                                    if (fechaCompleta >= DateTime.Now)
                                    {
                                        <tr>
                                            <td>@item.IdCita</td>
                                            <td>@($"{item.Fecha:dd/MM/yyyy} {item.Hora:HH:mm}")</td>
                                            <td>@item.NombreTipoCita</td>
                                        </tr>
                                    }
                                }
                            </tbody>
                        </table>

                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="contact-btn" data-bs-dismiss="modal" id="Retroceso">Close</button>

            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="ModalCitasPasadas" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="formulario contact-form contact-form-two">
                <div class="container">
                    <div class="contact-wrap">
                        <h2>Revisión de datos ingresados</h2>
                        <table id="tablaCitasPasadas" class="table">
                            <thead>
                                <tr>
                                    <th>ID Cita</th>
                                    <th>Fecha y Hora</th>
                                    <th>Tipo de Cita</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    var fechaCompleta = new DateTime(item.Fecha.Year, item.Fecha.Month, item.Fecha.Day, item.Hora.Hour, item.Hora.Minute, 0);
                                    if (fechaCompleta < DateTime.Now)
                                    {
                                        <tr>
                                            <td>@item.IdCita</td>
                                            <td>@($"{item.Fecha:dd/MM/yyyy} {item.Hora:HH:mm}")</td>
                                            <td>@item.NombreTipoCita</td>
                                        </tr>
                                    }
                                }
                            </tbody>
                        </table>

                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="contact-btn" data-bs-dismiss="modal" id="Retroceso">Close</button>

            </div>
        </div>
    </div>
</div>



<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script src="~/calendario/scriptcalendar.js"></script>

<script>
    $(document).ready(function () {
      const $tablaFuturas = $('#tablaCitasFuturas');
      const $tablaPasadas = $('#tablaCitasPasadas');

      // Inicializar DataTable solo si la tabla existe y aún no ha sido inicializada
      if ($tablaFuturas.length && !$.fn.DataTable.isDataTable($tablaFuturas)) {
        $tablaFuturas.DataTable({
          language: {
            url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json'
          }
        });
      }

      if ($tablaPasadas.length && !$.fn.DataTable.isDataTable($tablaPasadas)) {
        $tablaPasadas.DataTable({
          language: {
            url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json'
          }
        });
      }
    });
</script>

